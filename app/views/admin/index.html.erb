<div class="content-section">
  <div class="container">
    <div class="section-header">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h2 class="section-title" style="margin-bottom: 0;">Admin Dashboard</h2>
        <%= button_to "Logout", admin_logout_path, method: :delete, class: "btn btn-outline", style: "padding: 0.5rem 1rem;", data: { turbo: false } %>
      </div>
    </div>
    
    <div class="section-content">
    <!-- Tabs -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
      <div class="admin-tabs">
        <button class="admin-tab active" data-tab="attendees" onclick="switchTab('attendees')">
          Attendees (<%= @attendees.count %>)
        </button>
        <button class="admin-tab" data-tab="counsellors" onclick="switchTab('counsellors')">
          Counselors (<%= @counsellors.count %>)
        </button>
      </div>
      <div style="display: flex; gap: 0.5rem;">
        <a href="<%= admin_export_attendees_path(format: :csv) %>" class="btn btn-outline" style="padding: 0.5rem 1rem;">
          Export Attendees CSV
        </a>
        <a href="<%= admin_export_counsellors_path(format: :csv) %>" class="btn btn-outline" style="padding: 0.5rem 1rem;">
          Export Counselors CSV
        </a>
      </div>
    </div>

    <!-- Attendees Tab Content -->
    <div id="attendees-tab" class="admin-tab-content active">
      <h3 style="margin-bottom: 1.5rem;">Registered Attendees</h3>
      
      <% if @attendees.any? %>
        <div class="admin-table-container" style="overflow-x: auto;">
          <table class="admin-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Payment Status</th>
                <th>Date of Birth</th>
                <th>Age</th>
                <th>Gender</th>
                <th>Phone</th>
                <th>Email</th>
                <th>T-Shirt Size</th>
                <th>Ecclesia</th>
                <th>Piano</th>
                <th>Address</th>
                <th>Medical Conditions</th>
                <th>Dietary Restrictions</th>
                <th>Allergies</th>
                <th>Special Needs</th>
                <th>Notes</th>
                <th>Guardian 1</th>
                <th>Guardian 1 Contact</th>
                <th>Guardian 2</th>
                <th>Guardian 2 Contact</th>
                <th>Emergency Contact 1</th>
                <th>Emergency Contact 2</th>
                <th>Registration Date</th>
              </tr>
            </thead>
            <tbody>
              <% @attendees.each do |attendee| %>
                <% registration = attendee.attendee_registration %>
                <tr>
                  <td>
                    <strong>
                      <%= link_to "#{attendee.first_name} #{attendee.last_name}", admin_attendee_path(attendee), style: "color: #2c5f2d; text-decoration: none;", onmouseover: "this.style.textDecoration='underline'", onmouseout: "this.style.textDecoration='none'" %>
                    </strong>
                  </td>
                  <td>
                    <% if registration.paid? %>
                      <% if registration.paid_in_full? %>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                          Paid in Full
                        </span>
                        <div class="text-xs text-gray-500 mt-1">
                          $<%= sprintf('%.2f', registration.amount_paid) %>
                        </div>
                      <% elsif registration.paid_deposit? %>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                          Deposit Paid
                        </span>
                        <div class="text-xs text-gray-500 mt-1">
                          Paid: $<%= sprintf('%.2f', registration.amount_paid) %><br>
                          Balance: $<%= sprintf('%.2f', registration.remaining_balance) %>
                        </div>
                      <% else %>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                          Paid
                        </span>
                      <% end %>
                    <% else %>
                      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                        Not Paid
                      </span>
                    <% end %>
                  </td>
                  <td><%= attendee.date_of_birth&.strftime("%m/%d/%Y") %></td>
                  <td><%= attendee.age %></td>
                  <td><%= attendee.gender %></td>
                  <td><%= attendee.phone %></td>
                  <td><%= attendee.email %></td>
                  <td><%= attendee.tshirt_size %></td>
                  <td><%= attendee.ecclesia %></td>
                  <td><%= attendee.piano ? "Yes" : "No" %></td>
                  <td>
                    <% if attendee.address_line_1.present? %>
                      <%= attendee.address_line_1 %><br>
                      <% if attendee.address_line_2.present? %><%= attendee.address_line_2 %><br><% end %>
                      <%= [attendee.city, attendee.state, attendee.zip].compact.join(", ") %>
                    <% else %>
                      <em>Same as Guardian</em>
                    <% end %>
                  </td>
                  <td><%= attendee.medical_conditions %></td>
                  <td><%= attendee.dietary_restrictions %></td>
                  <td><%= attendee.allergies %></td>
                  <td><%= attendee.special_needs %></td>
                  <td><%= attendee.notes %></td>
                  <td>
                    <%= registration.guardian_1_name %><br>
                    <%= registration.guardian_1_email %><br>
                    <%= registration.guardian_1_phone %>
                  </td>
                  <td>
                    <%= registration.guardian_1_address_line_1 %><br>
                    <% if registration.guardian_1_address_line_2.present? %><%= registration.guardian_1_address_line_2 %><br><% end %>
                    <%= registration.guardian_1_city %>, <%= registration.guardian_1_state %> <%= registration.guardian_1_zip %>
                  </td>
                  <td>
                    <% if registration.guardian_2_name.present? %>
                      <%= registration.guardian_2_name %><br>
                      <%= registration.guardian_2_email %><br>
                      <%= registration.guardian_2_phone %>
                    <% else %>
                      <em>N/A</em>
                    <% end %>
                  </td>
                  <td>
                    <% if registration.guardian_2_name.present? %>
                      <% if registration.guardian_2_same_address %>
                        <em>Same as Guardian 1</em>
                      <% else %>
                        <%= registration.guardian_2_address_line_1 %><br>
                        <% if registration.guardian_2_address_line_2.present? %><%= registration.guardian_2_address_line_2 %><br><% end %>
                        <%= registration.guardian_2_city %>, <%= registration.guardian_2_state %> <%= registration.guardian_2_zip %>
                      <% end %>
                    <% else %>
                      <em>N/A</em>
                    <% end %>
                  </td>
                  <td>
                    <%= registration.emergency_contact_1_name %><br>
                    <%= registration.emergency_contact_1_phone %>
                  </td>
                  <td>
                    <% if registration.emergency_contact_2_name.present? %>
                      <%= registration.emergency_contact_2_name %><br>
                      <%= registration.emergency_contact_2_phone %>
                    <% else %>
                      <em>N/A</em>
                    <% end %>
                  </td>
                  <td><%= registration.created_at.strftime("%m/%d/%Y") %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <p class="text-gray-600">No attendees registered yet.</p>
      <% end %>
    </div>

    <!-- Counsellors Tab Content -->
    <div id="counsellors-tab" class="admin-tab-content">
      <h3 style="margin-bottom: 1.5rem;">Registered Counselors</h3>
      
      <% if @counsellors.any? %>
        <div class="admin-table-container" style="overflow-x: auto;">
          <table class="admin-table">
            <thead>
              <tr>
                <th>Registration Date</th>
                <th>Name</th>
                <th>Address</th>
                <th>Phone</th>
                <th>Email</th>
                <th>Ecclesia</th>
                <th>T-Shirt Size</th>
                <th>Piano</th>
              </tr>
            </thead>
            <tbody>
              <% @counsellors.each do |counsellor| %>
                <!-- Counselor 1 Row -->
                <tr style="background-color: #f9fafb;">
                  <td rowspan="2" style="vertical-align: top; border-bottom: 2px solid #e5e7eb;">
                    <strong>
                      <%= link_to counsellor.created_at.strftime("%m/%d/%Y"), admin_counsellor_path(counsellor), style: "color: #2c5f2d; text-decoration: none;", onmouseover: "this.style.textDecoration='underline'", onmouseout: "this.style.textDecoration='none'" %>
                    </strong><br>
                    <small style="color: #6b7280;"><%= counsellor.created_at.strftime("%I:%M %p") %></small>
                  </td>
                  <td>
                    <strong>Counselor 1:</strong><br>
                    <%= counsellor.counsellor_1_first_name %> <%= counsellor.counsellor_1_last_name %>
                  </td>
                  <td>
                    <%= counsellor.counsellor_1_address_line_1 %><br>
                    <%= counsellor.counsellor_1_city %>, <%= counsellor.counsellor_1_state_province_region %> <%= counsellor.counsellor_1_postal_code %><br>
                    <%= counsellor.counsellor_1_country %>
                  </td>
                  <td><%= counsellor.counsellor_1_phone %></td>
                  <td><%= counsellor.counsellor_1_email %></td>
                  <td><%= counsellor.counsellor_1_ecclesia %></td>
                  <td><%= counsellor.counsellor_1_tshirt_size %></td>
                  <td><%= counsellor.counsellor_1_piano %></td>
                </tr>
                <!-- Counselor 2 Row -->
                <tr style="background-color: #ffffff; border-bottom: 2px solid #e5e7eb;">
                  <td>
                    <strong>Counselor 2:</strong><br>
                    <%= counsellor.counsellor_2_first_name %> <%= counsellor.counsellor_2_last_name %>
                  </td>
                  <td>
                    <%= counsellor.counsellor_2_address_line_1 %><br>
                    <%= counsellor.counsellor_2_city %>, <%= counsellor.counsellor_2_state_province_region %> <%= counsellor.counsellor_2_postal_code %><br>
                    <%= counsellor.counsellor_2_country %>
                  </td>
                  <td><%= counsellor.counsellor_2_phone %></td>
                  <td><%= counsellor.counsellor_2_email %></td>
                  <td><%= counsellor.counsellor_2_ecclesia %></td>
                  <td><%= counsellor.counsellor_2_tshirt_size %></td>
                  <td><%= counsellor.counsellor_2_piano %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <p class="text-gray-600">No counselor registrations yet.</p>
      <% end %>
    </div>
    </div>
  </div>
</div>

<script>
  function switchTab(tabName) {
    // Hide all tab contents
    document.querySelectorAll('.admin-tab-content').forEach(content => {
      content.classList.remove('active');
    });
    
    // Remove active class from all tabs
    document.querySelectorAll('.admin-tab').forEach(tab => {
      tab.classList.remove('active');
    });
    
    // Show selected tab content
    document.getElementById(tabName + '-tab').classList.add('active');
    
    // Add active class to selected tab
    document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
  }
</script>

